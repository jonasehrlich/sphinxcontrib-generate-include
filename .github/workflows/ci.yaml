name: CI
on:
  push:
    tags-ignore:
      - v[0-9]+.[0-9]+.[0-9]+
  workflow_call:

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.12", "3.13", "3.14"]
    steps:
      - uses: actions/checkout@v3
      - uses: astral-sh/setup-uv@v7
      - run: uv sync
      - run: uv pip install -e .
      - name: test
        run: uv run pytest

  check-format:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: astral-sh/setup-uv@v7
      - name: check-format
        run: uv run ruff format --check

  lint:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: astral-sh/setup-uv@v7
      - name: lint
        run: uv run ruff check --output-format github

  check-types:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: astral-sh/setup-uv@v7
      - name: check-types
        run: uv run pyrefly check

  build-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: astral-sh/setup-uv@v7
      - run: uv sync
      - run: uv pip install -e .
      - name: build-docs
        run: uv run sphinx-build -W docs docs/_build
